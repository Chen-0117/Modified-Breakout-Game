from DQN_Agent import DQNAgent
from Hyperparameters import Hyperparameters
import numpy as np
import torch
import gym
from tqdm import tqdm
import time
import matplotlib.pyplot as plt
from Wrapper import ActionWrapper
from warnings import filterwarnings
filterwarnings(action='ignore', category=DeprecationWarning, message='`np.bool8` is a deprecated alias')

class DDQNAgent(DQNAgent):
    def __init__(self, *args, **kwargs):
        super().__init__(*args, **kwargs)

    def learn(self):
        if self.memory_size() < self.b: return
        exps = self.sample_memory()
        s, a, r, s_, d = map(torch.stack, zip(*exps))

        # bellman backup for DDQN algorithm, here action selection is done
        # using main network and q value computation is done using target network
        pred_q = self.Q(s)[np.arange(self.b), a]
        target_q = r + (1 - d.float()) * self.g * self.T(s_)[
            np.arange(self.b),
            self.Q(s_).argmax(axis=1)
        ]

        # backprop
        self.Q.optimizer.zero_grad()
        loss = self.Q.loss_fn(pred_q, target_q)
        current_loss = loss
        loss.backward()
        self.Q.optimizer.step()

        return current_loss.item()

    def save(self, steps):
        torch.save(
            dict(model=self.Q.state_dict(), exploration_rate=self.e),
            f'DDQNAgent-{steps}.chkpt',
        )


from collections import deque
def train():
    steps_recording = []
    rewards_recording = []
    average_reward_recording = []
    loss_recording = []
    average_reward = 0
    steps = 0
    start_time = time.time()
    time_recording = []
    for episode in range(1, hp.num_episodes+1):
        state, info = env.reset()
        old_lives = info['lives']
        current_loss = 0

        # shoot ball so that the ball becomes visible
        state = env.step(1)
        state = state[0]
        state = agent.preprocess(state)
        state = torch.stack([state, state, state, state])

        # print('===================================')
        # print(f'Epoch: {epoch}')
        ep_steps = 0
        total_reward = 0
        ended = False
        truncated = False
        while not ended or truncated:
            action = agent.act(state)
            (next_state, reward, ended, truncated, info) = env.step(action)
            next_state = agent.preprocess(next_state)
            next_state = torch.stack([*state[1:], next_state])

            help_reward = reward
            # if old_lives > info['lives']:
            #     help_reward -=1

            agent.cache((state, action, help_reward, next_state, ended or truncated))
            state = next_state
            total_reward += reward
            ep_steps += 1
            loss = agent.learn()
            if loss:
                current_loss += loss
            steps +=1


            if old_lives > info['lives']:
                state = env.step(1)
                state = state[0]
                state = agent.preprocess(state)
                state = torch.stack([state, state, state, state])
                old_lives = info['lives']

        rewards_recording.append(total_reward)
        average_reward = average_reward + (total_reward - average_reward) / episode
        average_reward_recording.append(average_reward)
        loss_recording.append(current_loss)

        steps_recording.append(ep_steps)
        episode_time = time.time() - start_time
        time_recording.append(episode_time)
        print(f"Episode: {episode} loss: {current_loss} Total Reward: {total_reward} Average Reward: {total_reward/5} ep_Steps: {ep_steps}  Steps: {steps} time:{episode_time}")

        # Decay epsilon at the end of each episode
        agent.update_epsilon()

        if steps % agent.r == 0:
            agent.update_target_network()
            print(f'Step: {steps}, Return: {total_reward}')

        if episode % 100 == 0:
            agent.save(f'final-{episode}')

    return steps_recording, rewards_recording, loss_recording, average_reward_recording, time_recording



if __name__ == '__main__':
    hp = Hyperparameters()

    env = gym.make('Breakout-v4', frameskip=4, repeat_action_probability=0, render_mode='rgb_array')
    env = ActionWrapper(env, hp.uncertain_prob)
    env.reset()

    env.metadata['render_fps'] = 24

    ## Agent
    agent = DQNAgent(
        env,
        hp,
        device=torch.device('cpu'),
    )

    # agent.load("DDQNAgent-final-100.chkpt")


    steps_recording, rewards_recording, loss_recording, average_reward_recording, time_recording = train()

    print(steps_recording)
    print(rewards_recording)
    print(loss_recording)
    print(average_reward_recording)


    plt.figure()
    plt.title("loss")
    plt.plot(loss_recording, label='Loss', color='red')
    plt.xlabel("Episode")
    plt.ylabel("Training Loss")

    # Save the figure
    plt.savefig(f'./result/Learning_Curve_{hp.num_episodes}.png',
                format='png', dpi=600, bbox_inches='tight')
    plt.tight_layout()
    plt.grid(True)
    plt.show()

    plt.figure()
    plt.title("Average Reward")
    plt.plot(average_reward_recording, label='average reward', color='green')
    plt.xlabel("Episode")
    plt.ylabel("Average Reward")

    # Save the figure
    plt.savefig(f'./result/Average_rewarding_Curve_{hp.num_episodes}.png',
                format='png', dpi=600, bbox_inches='tight')
    plt.tight_layout()
    plt.grid(True)
    plt.show()

    plt.figure()
    plt.title("Time cost")
    plt.plot(time_recording, label='episode_time', color='blue')
    plt.xlabel("Episode")
    plt.ylabel("Time cost")

    # Save the figure
    plt.savefig(f'./result/Time_Curve_{hp.num_episodes}.png',
                format='png', dpi=600, bbox_inches='tight')
    plt.tight_layout()
    plt.grid(True)
    plt.show()












    # plt.figure()
    # plt.title("Reward")
    # plt.plot(rewards_recording, label='Reward', color='gray')
    # # plt.plot([i for i in range(hp.num_episodes)], label='Moving Average', color='red')
    # plt.xlabel("Episode")
    # plt.ylabel("Reward")
    # plt.legend()
    #
    # plt.savefig(f'./result/Reward_vs_Episode_{hp.num_episodes}.png', format='png', dpi=600, bbox_inches='tight')
    # plt.tight_layout()
    # plt.show()
    # plt.clf()
    # plt.close()

    # plt.figure()
    # plt.title("Step")
    # plt.plot(steps_recording,  label='step', color='blue')
    # # plt.yscale("log")
    # plt.xlabel("Episode")
    # plt.ylabel("Steps")
    # plt.show()
    #
    # # Save the figure
    # plt.savefig(f'./result/step_Curve_{hp.num_episodes}.png',
    #             format='png', dpi=600, bbox_inches='tight')
    # plt.tight_layout()
    # plt.grid(True)
    # plt.show()




"""
[122, 121, 164, 132, 119, 196, 122, 201, 120, 196, 170, 127, 124, 147, 119, 194, 123, 119, 182, 118, 149, 166, 120, 194, 192, 130, 121, 120, 118, 120, 120, 196, 253, 193, 132, 167, 163, 216, 118, 118, 153, 247, 275, 197, 147, 120, 172, 118, 118, 190, 120, 148, 150, 119, 271, 175, 353, 119, 177, 167, 165, 203, 194, 120, 165, 184, 170, 164, 165, 241, 235, 228, 200, 151, 212, 226, 221, 260, 242, 162, 138, 166, 148, 273, 148, 221, 274, 378, 230, 122, 195, 217, 118, 219, 148, 120, 152, 193, 198, 148, 162, 196, 120, 123, 185, 287, 298, 271, 147, 208, 193, 170, 147, 237, 168, 167, 150, 300, 242, 146, 147, 177, 178, 177, 120, 248, 146, 148, 194, 178, 119, 147, 191, 202, 207, 243, 168, 291, 117, 258, 179, 160, 156, 194, 170, 119, 119, 120, 290, 324, 192, 229, 316, 192, 164, 147, 259, 324, 120, 186, 160, 193, 120, 175, 324, 127, 204, 154, 197, 187, 146, 146, 168, 157, 147, 147, 120, 165, 167, 118, 195, 177, 171, 148, 177, 223, 118, 262, 192, 118, 168, 194, 251, 226, 148, 157, 158, 124, 155, 196, 119, 195, 147, 148, 152, 198, 147, 222, 147, 285, 121, 199, 142, 148, 146, 186, 222, 227, 206, 349, 214, 148, 203, 270, 132, 207, 155, 223, 148, 146, 148, 192, 181, 193, 370, 120, 199, 172, 251, 194, 215, 256, 155, 241, 194, 120, 178, 300, 119, 187, 220, 252, 178, 182, 174, 186, 147, 145, 156, 118, 259, 183, 199, 147, 228, 226, 126, 148, 222, 146, 199, 222, 224, 118, 149, 367, 244, 193, 178, 159, 180, 298, 125, 178, 252, 310, 147, 211, 252, 149, 147, 193, 165, 348, 120, 222, 194, 181, 327, 147, 192, 148, 153, 152, 176, 178, 150, 147, 191, 210, 213, 313, 196, 209, 216, 244, 241, 149, 161, 177, 119, 119, 174, 119, 200, 196, 148, 232, 147, 148, 148, 318, 120, 144, 198, 186, 189, 156, 122, 198, 194, 179, 162, 179, 273, 138, 120, 206, 177, 203, 177, 178, 172, 183, 249, 208, 186, 214, 352, 192, 330, 120, 177, 122, 146, 119, 149, 148, 206, 235, 178, 247, 146, 194, 147, 202, 177, 292, 173, 273, 181, 147, 125, 207, 120, 190, 146, 178, 184, 221, 119, 124, 255, 177, 178, 166, 177, 231, 316, 153, 364, 119, 119, 147, 181, 178, 176, 216, 214, 148, 146, 178, 165, 165, 140, 147, 226, 146, 148, 122, 223, 135, 286, 214, 148, 148, 165, 147, 240, 156, 161, 194, 149, 168, 120, 174, 274, 167, 147, 166, 146, 170, 120, 194, 120, 147, 166, 177, 177, 213, 119, 223, 141, 119, 224, 223, 147, 177, 339, 166, 177, 151, 182, 199, 154, 246, 148, 165, 120, 295, 200, 183, 138, 135, 165, 181, 187, 220, 133, 120, 196, 226, 180, 120, 118, 148, 123, 146, 254, 144, 197, 119, 327, 182, 281, 201, 214, 180, 177, 241]
[0.0, 0.0, 1.0, 0.0, 0.0, 2.0, 0.0, 2.0, 0.0, 2.0, 1.0, 0.0, 0.0, 1.0, 0.0, 2.0, 0.0, 0.0, 2.0, 0.0, 1.0, 1.0, 0.0, 2.0, 2.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 2.0, 4.0, 2.0, 0.0, 1.0, 1.0, 2.0, 0.0, 0.0, 1.0, 3.0, 4.0, 2.0, 1.0, 0.0, 1.0, 0.0, 0.0, 1.0, 0.0, 1.0, 1.0, 0.0, 4.0, 1.0, 6.0, 0.0, 2.0, 1.0, 1.0, 2.0, 2.0, 0.0, 1.0, 2.0, 1.0, 1.0, 1.0, 3.0, 3.0, 3.0, 2.0, 1.0, 2.0, 3.0, 3.0, 4.0, 3.0, 1.0, 0.0, 1.0, 1.0, 4.0, 1.0, 3.0, 4.0, 6.0, 3.0, 0.0, 2.0, 2.0, 0.0, 2.0, 1.0, 0.0, 1.0, 2.0, 2.0, 1.0, 1.0, 2.0, 0.0, 0.0, 2.0, 4.0, 4.0, 4.0, 1.0, 3.0, 2.0, 1.0, 1.0, 4.0, 1.0, 0.0, 1.0, 4.0, 3.0, 0.0, 1.0, 2.0, 2.0, 2.0, 0.0, 3.0, 1.0, 1.0, 2.0, 2.0, 0.0, 1.0, 2.0, 2.0, 2.0, 3.0, 1.0, 5.0, 0.0, 3.0, 2.0, 1.0, 1.0, 2.0, 1.0, 0.0, 0.0, 0.0, 4.0, 4.0, 2.0, 3.0, 6.0, 1.0, 1.0, 1.0, 4.0, 5.0, 0.0, 1.0, 1.0, 2.0, 0.0, 2.0, 6.0, 0.0, 2.0, 1.0, 2.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 1.0, 1.0, 0.0, 2.0, 2.0, 1.0, 1.0, 2.0, 3.0, 0.0, 4.0, 2.0, 0.0, 1.0, 2.0, 4.0, 3.0, 1.0, 1.0, 1.0, 0.0, 1.0, 2.0, 0.0, 2.0, 1.0, 1.0, 1.0, 2.0, 1.0, 3.0, 1.0, 5.0, 0.0, 2.0, 0.0, 1.0, 0.0, 1.0, 3.0, 3.0, 3.0, 6.0, 3.0, 1.0, 2.0, 4.0, 0.0, 3.0, 1.0, 3.0, 1.0, 1.0, 1.0, 2.0, 2.0, 2.0, 6.0, 0.0, 2.0, 1.0, 3.0, 2.0, 3.0, 3.0, 1.0, 3.0, 1.0, 0.0, 2.0, 5.0, 0.0, 2.0, 3.0, 4.0, 2.0, 2.0, 2.0, 2.0, 1.0, 1.0, 1.0, 0.0, 4.0, 2.0, 2.0, 1.0, 3.0, 3.0, 0.0, 1.0, 3.0, 1.0, 2.0, 3.0, 3.0, 0.0, 1.0, 9.0, 3.0, 2.0, 2.0, 0.0, 2.0, 5.0, 0.0, 2.0, 4.0, 5.0, 1.0, 2.0, 4.0, 1.0, 1.0, 2.0, 1.0, 6.0, 0.0, 2.0, 2.0, 2.0, 5.0, 1.0, 2.0, 1.0, 1.0, 1.0, 1.0, 2.0, 1.0, 1.0, 2.0, 3.0, 2.0, 6.0, 2.0, 2.0, 2.0, 3.0, 3.0, 1.0, 0.0, 2.0, 0.0, 0.0, 2.0, 0.0, 2.0, 2.0, 1.0, 2.0, 0.0, 1.0, 1.0, 5.0, 0.0, 0.0, 2.0, 2.0, 2.0, 1.0, 0.0, 2.0, 2.0, 0.0, 0.0, 2.0, 4.0, 0.0, 0.0, 2.0, 2.0, 2.0, 2.0, 2.0, 1.0, 2.0, 2.0, 3.0, 2.0, 3.0, 5.0, 2.0, 6.0, 0.0, 2.0, 0.0, 1.0, 0.0, 1.0, 1.0, 2.0, 3.0, 2.0, 3.0, 1.0, 2.0, 1.0, 2.0, 2.0, 4.0, 1.0, 4.0, 2.0, 1.0, 0.0, 2.0, 0.0, 1.0, 1.0, 2.0, 2.0, 3.0, 0.0, 0.0, 4.0, 1.0, 2.0, 1.0, 2.0, 3.0, 4.0, 0.0, 6.0, 0.0, 0.0, 1.0, 2.0, 2.0, 2.0, 3.0, 2.0, 1.0, 1.0, 2.0, 1.0, 1.0, 0.0, 1.0, 2.0, 1.0, 1.0, 0.0, 3.0, 0.0, 4.0, 3.0, 1.0, 1.0, 1.0, 1.0, 3.0, 1.0, 1.0, 2.0, 0.0, 1.0, 0.0, 0.0, 4.0, 1.0, 1.0, 1.0, 1.0, 1.0, 0.0, 2.0, 0.0, 1.0, 1.0, 2.0, 2.0, 2.0, 0.0, 3.0, 0.0, 0.0, 3.0, 3.0, 1.0, 2.0, 5.0, 1.0, 2.0, 1.0, 2.0, 2.0, 1.0, 3.0, 1.0, 1.0, 0.0, 4.0, 2.0, 0.0, 0.0, 0.0, 1.0, 1.0, 2.0, 2.0, 0.0, 0.0, 2.0, 3.0, 2.0, 0.0, 0.0, 1.0, 0.0, 1.0, 4.0, 0.0, 2.0, 0.0, 5.0, 2.0, 4.0, 2.0, 2.0, 2.0, 2.0, 3.0]
[0.0034033800745048026, 0.0013808225376159555, 0.34284301638095727, 0.18751126426195697, 0.21423495421481675, 0.2184808117896182, 0.4582100189115863, 0.8325638496742158, 0.3400806575382376, 0.482718553947052, 0.667670213184465, 0.23001279280833842, 0.6066390946652973, 0.3993567608995363, 0.6472237160778604, 0.8807388201239519, 0.3365479217900429, 0.6187951139654615, 0.7122438513979432, 0.5814346425613621, 0.611959000932984, 0.51539810813847, 0.4177831653651083, 0.7139156881894451, 0.8549178825342096, 0.4831398923051893, 0.33717581603559665, 0.4411008546812809, 0.3093342393185594, 0.35638114393805154, 0.35985964762221556, 0.7720699162236997, 0.9052328613761347, 0.8544621377659496, 0.4633312951991684, 0.7276609855052811, 1.1189584322692099, 1.0158232048215723, 0.5207779550219129, 0.6966261613342795, 0.9446574229987164, 1.2577898768613522, 1.4025042289104022, 1.2420638595322089, 0.5067428553065838, 0.7890524819304119, 0.7556876801863837, 0.3446109742126282, 0.9186032032484945, 0.90460301928033, 0.4737496059060504, 0.46875419663774665, 0.6432012651275727, 0.7009087535516301, 1.6115658994058322, 0.5721731535813888, 1.6149417215165158, 0.730628405995958, 0.9655688033999468, 0.8301021903262154, 0.8311274081843294, 1.3206519988671062, 0.8617591728034313, 0.48759514000812487, 0.8313933524259483, 1.5253858400901663, 1.1540332478653, 0.9226101158092206, 0.6755962224106042, 1.5600289243993757, 1.5080413568794029, 1.4474952810287505, 1.1487504235501547, 0.9230569573883258, 1.64999300780255, 1.590926181335817, 1.1425876638713817, 1.7427850191616017, 1.8127446242469887, 0.9389152933981677, 0.7172574535397871, 0.9830451094421733, 1.0876706087728962, 2.4404117234807927, 1.5114980636171822, 1.8247051647667831, 1.7410205433361625, 2.524667548324942, 1.9582984604257945, 0.6896702429294237, 1.5231799106331891, 1.691404307321136, 1.2502972664860863, 2.2373107861785684, 1.243232139929205, 0.8897866904626426, 1.3655337724921992, 1.5331821049549035, 1.3838054554580594, 0.8381867138796224, 1.6005415695490228, 1.6164230940812558, 0.7812907915995311, 1.2841236037675117, 1.5251064237963874, 2.74017158168499, 2.594729693402769, 2.2055525373507407, 1.4183792929397896, 1.6455776653856447, 1.7356904317857698, 1.4009483934787568, 1.2069791234171134, 2.4592956059968856, 1.2392125340593338, 1.8415878962623538, 1.0595298962361994, 2.755014846163249, 2.2496735350432573, 1.2939673154905904, 1.2226317745844426, 1.630704817311198, 1.4106256792620115, 1.5125818095366412, 1.466861541455728, 1.947782116360031, 1.2540360131679336, 1.060682590250508, 1.6129214121483528, 1.501132648985731, 0.7226811336713581, 0.9781630083589334, 1.3434743742982391, 1.589109723684487, 1.1637503261772508, 1.6890688787452746, 1.464292133867275, 2.6756033271440174, 1.1629719585325802, 2.3220858515342115, 1.2734634803618974, 1.1993316056141339, 1.5739687262885127, 1.6944167952406133, 1.4798515225629671, 0.975283465202665, 1.2972075331817905, 1.0255897334391193, 2.4256313704390777, 2.829085892291914, 1.4634795571873838, 1.7948736755970458, 3.118583735971697, 1.476104326051427, 1.2755311011069352, 1.5301285382302012, 2.1460660513948824, 3.261283984329566, 1.1710263939712604, 1.482548499636323, 1.092335096160241, 1.1449502406294414, 0.8404711553994275, 1.4707202569388755, 2.494500779360351, 1.3239969842270511, 1.7601466916858044, 1.1048827366539626, 2.072271851795449, 1.556324820185182, 1.2350068895648292, 1.1307549543798814, 1.338550093512822, 1.3283847987422632, 1.0699315983474662, 1.6807449460993666, 1.1150298742395535, 1.2371167984874774, 1.1748365667936014, 0.9558270994675695, 2.021161626031244, 1.8720748201867536, 1.6710870714268822, 1.5924315939510052, 1.5091867432656727, 1.7932013434219698, 0.8101909556316969, 2.5338835814927734, 1.7955823360262002, 0.8428826260078495, 1.1731941978177929, 1.3901725057476142, 2.1609126612893306, 1.923210049919362, 1.439705646265793, 1.366755187687886, 1.271655723213371, 1.0972937258466118, 1.1722995239815646, 1.5258176212782928, 1.22844587052532, 1.9454536892699252, 1.2946965587634622, 1.4309152209825697, 1.3066486800162238, 1.7580241618525179, 1.4432308873620059, 1.8625396376828576, 1.8662283871526597, 3.021716477712289, 1.2591193657626718, 2.1753367385863385, 1.2312021466841543, 1.2602628767199349, 1.4545917075865873, 1.7946257617477386, 2.601627742056735, 2.2216226098771585, 1.8714492439303285, 3.4636538918730366, 1.814982053836502, 1.5941076108611014, 2.3348434695108153, 2.319784304638233, 0.9078292940084793, 1.8799275312376267, 1.3783492561542516, 1.1747279738465295, 1.5813398989594134, 1.2923461656773725, 1.3153131857543485, 1.6160366935710044, 1.5155987139369245, 1.7554415485465142, 2.8978298040856316, 1.1246487143180275, 1.3852565361794404, 2.0392069529680157, 2.692699749230087, 2.041673439232909, 2.3160444236891635, 2.4051197831631725, 1.7913191874285985, 2.4560681210296025, 1.7512201772169647, 1.1094779592422128, 2.0770911869803967, 3.379016780960228, 1.1610102047816326, 2.242477008865535, 2.210725518223626, 2.8099809531013307, 2.2905509163974784, 1.989544443495106, 2.1950203332708043, 2.117003611241671, 1.59357073558931, 1.6676677827672393, 1.5034204006024083, 1.3994571272996836, 2.164534499086585, 1.4657431488667498, 1.8438699937069032, 1.321055309052099, 1.8239557913748286, 2.0393645808762813, 1.1882481071152142, 1.0233119606800756, 1.8922883400191495, 1.3582361718381435, 2.1860593331439304, 1.768214820920548, 1.5777602221314737, 1.1541261950296757, 1.165851757321434, 2.923902790515058, 1.9537326949885028, 1.6426727151356317, 1.9163923174510273, 1.2405663770023239, 1.492847254510707, 3.0520069172707736, 1.1445898979472986, 1.7693002599344254, 2.2778460673343943, 3.399778140890703, 1.1316082937828469, 2.1213623504081625, 2.845764723377215, 1.6283858834376588, 1.5818611792929005, 1.3883407752909989, 1.8370890318146849, 3.4866114159140125, 1.4967755995312473, 2.3801961739845865, 1.5270113368296734, 1.6691762188529538, 3.2883948359885835, 1.48647970680031, 1.7819214002010995, 0.9848622741483268, 1.3803766105938848, 1.2605366763164056, 1.7845076647608948, 1.755311658132996, 1.7961992358941643, 2.173819283139892, 2.252547626798332, 2.196200484466317, 1.9850587980654382, 2.8148871330868133, 1.7557250042882515, 1.9808201785162964, 2.3535715468024136, 2.5409725845092908, 2.4326359713595593, 1.1635442109800351, 1.5293451062534587, 1.6328809700062266, 0.8837183374125743, 0.9515218394208205, 1.6777316372863424, 1.2398751002328936, 1.9701333687080478, 1.89955075054786, 1.3734011954402376, 2.099263783878996, 1.2325599875193802, 1.5115728888486046, 1.401620254640875, 2.708261800722539, 1.189898802069365, 1.178690126620495, 2.138712194224354, 1.7260274712898536, 1.7434900692715019, 1.1216234857729432, 0.9695331833245291, 1.7569058080334798, 1.5766821926954435, 1.4266008051472454, 1.3937824822114635, 1.7118701094823336, 2.528670365389189, 1.0922388720591698, 0.7463620284397621, 1.9447039661172312, 1.7838394004029396, 1.9828731592169788, 1.7271973380520649, 1.8185181172775629, 1.435237704870815, 1.6094349934828642, 2.1977517051273026, 2.352480722918699, 1.7620010571154126, 2.1855148254762753, 4.141765922096965, 2.099008462711936, 3.446687308525725, 1.1341832847356272, 1.4708031898080662, 1.366450884113874, 1.7326646950750728, 1.34310287986591, 1.5136895851101144, 1.4525268346915254, 1.9431950542566483, 2.3462887433342985, 1.6447513819148298, 2.4150413765801204, 1.712543557943718, 2.038701260538801, 1.150242449644793, 1.3960865103053948, 1.7775069065355638, 2.7143467175810656, 2.0477012296178145, 2.800790410159607, 1.5813650765194325, 1.6957329323013255, 1.0453823203170032, 1.8178145870624576, 1.2243023866176372, 1.6938584874660592, 1.5814568102869089, 1.7423041653128166, 1.923492843467102, 2.000541915433132, 1.2230115002348612, 1.079904458110832, 1.9062127920096827, 1.557459998097329, 1.9127423871977953, 1.4027818879112601, 2.0352361179502623, 2.3506295682600467, 3.2461679125881346, 1.2925548840139527, 3.5319959657899744, 1.311626901406271, 1.3163322504042299, 1.553752841482492, 1.6384972090054362, 1.7380653393047396, 1.569521303234069, 2.109744847726688, 2.069291139006964, 1.4546500953183568, 1.254676969427237, 1.7963819056276407, 1.379145740851527, 1.2346035704176757, 1.3347327497067454, 1.3375210945559957, 2.3735143068115576, 1.5934484365861863, 1.2088254345107998, 1.3537936930006254, 1.7700693105034588, 1.6964684965423658, 3.2557027990478673, 2.057518667254044, 1.4910349111705727, 1.4183448422700167, 1.2517711580403557, 1.4772052193384297, 1.991130714675819, 1.5153765846589522, 1.7156643916823668, 1.9508049071046116, 1.4632761689736071, 1.6612810982951487, 1.1420395401510177, 1.1572905529956188, 2.3388062615849776, 1.7880058170121629, 1.5398409042027197, 1.4443789539582212, 1.3885630590229994, 1.427734768458322, 0.8793809217986563, 1.7511659526462608, 1.2312731940401136, 1.3256502360236482, 1.4447146546699514, 1.5734081623850216, 1.5559035248043074, 1.7255844632309163, 0.9377491523773642, 1.6126767725945683, 1.1371632826521818, 1.013090086671582, 2.29056461309483, 2.0874312098749215, 1.3860446796825272, 1.712670752662234, 2.963504290648416, 1.392699785035802, 1.4435942911841266, 1.8126277567534999, 1.762755880554323, 2.085977022219595, 1.9383780387579463, 2.982647989778343, 1.3730537438605097, 1.5200035765956272, 1.1138162487040972, 3.0005491545744007, 2.2010508209205, 1.7797655343711085, 1.2695487442761078, 1.462026653203793, 1.6811117092875065, 1.7175704289147689, 1.8982902524003293, 2.071569599756913, 1.1572835752085666, 1.279904722217907, 1.9026663665572414, 2.191591883827641, 1.3039713598154776, 0.9784556782487925, 1.3378106720520009, 1.4110689536319114, 1.4540794944696245, 1.9895650546568504, 3.12867730302969, 1.3766906019372982, 2.5567090742479195, 1.3896799650610774, 3.7263549105518905, 1.5776201953231066, 3.0212780537876824, 2.0403644320977037, 1.7700198099628324, 2.055934337568033, 1.8963397769839503, 2.941840920604591]
[0.0, 0.0, 0.3333333333333333, 0.25, 0.2, 0.5, 0.4285714285714286, 0.625, 0.5555555555555556, 0.7, 0.7272727272727272, 0.6666666666666666, 0.6153846153846153, 0.6428571428571428, 0.6, 0.6875, 0.6470588235294118, 0.6111111111111112, 0.6842105263157895, 0.65, 0.6666666666666667, 0.6818181818181819, 0.6521739130434783, 0.7083333333333334, 0.76, 0.7307692307692307, 0.7037037037037036, 0.6785714285714285, 0.6551724137931034, 0.6333333333333333, 0.6129032258064516, 0.65625, 0.7575757575757576, 0.7941176470588235, 0.7714285714285714, 0.7777777777777777, 0.7837837837837837, 0.8157894736842104, 0.7948717948717947, 0.7749999999999998, 0.7804878048780486, 0.8333333333333331, 0.9069767441860463, 0.9318181818181817, 0.9333333333333331, 0.9130434782608694, 0.9148936170212765, 0.8958333333333333, 0.8775510204081632, 0.88, 0.8627450980392157, 0.8653846153846154, 0.8679245283018868, 0.8518518518518519, 0.9090909090909091, 0.9107142857142857, 1.0, 0.9827586206896551, 1.0, 1.0, 1.0, 1.0161290322580645, 1.0317460317460316, 1.015625, 1.0153846153846153, 1.0303030303030303, 1.0298507462686566, 1.0294117647058822, 1.0289855072463767, 1.057142857142857, 1.084507042253521, 1.111111111111111, 1.1232876712328765, 1.1216216216216215, 1.1333333333333333, 1.1578947368421053, 1.1818181818181819, 1.217948717948718, 1.2405063291139242, 1.2375000000000003, 1.2222222222222225, 1.2195121951219516, 1.2168674698795185, 1.2500000000000004, 1.2470588235294122, 1.2674418604651168, 1.2988505747126442, 1.3522727272727277, 1.370786516853933, 1.355555555555556, 1.3626373626373631, 1.3695652173913049, 1.35483870967742, 1.361702127659575, 1.357894736842106, 1.3437500000000007, 1.3402061855670109, 1.3469387755102047, 1.353535353535354, 1.3500000000000005, 1.346534653465347, 1.3529411764705888, 1.339805825242719, 1.3269230769230775, 1.333333333333334, 1.3584905660377364, 1.3831775700934585, 1.407407407407408, 1.403669724770643, 1.4181818181818189, 1.4234234234234242, 1.4196428571428579, 1.4159292035398237, 1.4385964912280709, 1.4347826086956528, 1.4224137931034488, 1.4188034188034193, 1.4406779661016955, 1.4537815126050426, 1.4416666666666673, 1.4380165289256204, 1.4426229508196726, 1.447154471544716, 1.451612903225807, 1.4400000000000004, 1.4523809523809528, 1.4488188976377956, 1.4453125000000002, 1.4496124031007753, 1.453846153846154, 1.4427480916030535, 1.4393939393939394, 1.4436090225563911, 1.447761194029851, 1.451851851851852, 1.4632352941176472, 1.4598540145985404, 1.4855072463768118, 1.4748201438848922, 1.4857142857142858, 1.4893617021276597, 1.4859154929577467, 1.4825174825174827, 1.4861111111111114, 1.4827586206896555, 1.4726027397260277, 1.4625850340136057, 1.452702702702703, 1.4697986577181212, 1.486666666666667, 1.4900662251655632, 1.5000000000000002, 1.5294117647058825, 1.525974025974026, 1.5225806451612904, 1.5192307692307694, 1.535031847133758, 1.5569620253164558, 1.5471698113207548, 1.5437500000000002, 1.5403726708074537, 1.54320987654321, 1.5337423312883438, 1.5365853658536588, 1.563636363636364, 1.5542168674698797, 1.5568862275449105, 1.5535714285714288, 1.5562130177514795, 1.5529411764705885, 1.5497076023391816, 1.546511627906977, 1.5433526011560696, 1.5402298850574716, 1.5371428571428576, 1.5340909090909096, 1.52542372881356, 1.52247191011236, 1.5195530726256987, 1.5111111111111115, 1.513812154696133, 1.5164835164835169, 1.5136612021857927, 1.5108695652173916, 1.5135135135135138, 1.5215053763440862, 1.5133689839572195, 1.5265957446808514, 1.5291005291005293, 1.5210526315789477, 1.5183246073298433, 1.5208333333333337, 1.5336787564766843, 1.5412371134020622, 1.5384615384615388, 1.535714285714286, 1.5329949238578684, 1.5252525252525255, 1.5226130653266334, 1.5250000000000004, 1.5174129353233834, 1.51980198019802, 1.517241379310345, 1.5147058823529413, 1.5121951219512197, 1.5145631067961167, 1.5120772946859906, 1.5192307692307696, 1.516746411483254, 1.5333333333333339, 1.526066350710901, 1.5283018867924532, 1.5211267605633807, 1.5186915887850472, 1.5116279069767447, 1.5092592592592597, 1.516129032258065, 1.5229357798165142, 1.529680365296804, 1.5500000000000005, 1.5565610859728511, 1.5540540540540546, 1.5560538116591933, 1.5669642857142863, 1.5600000000000005, 1.5663716814159296, 1.5638766519823792, 1.5701754385964917, 1.567685589519651, 1.5652173913043483, 1.5627705627705633, 1.5646551724137936, 1.5665236051502152, 1.568376068376069, 1.5872340425531921, 1.5805084745762719, 1.5822784810126589, 1.5798319327731098, 1.5857740585774065, 1.5875000000000006, 1.593360995850623, 1.5991735537190088, 1.5967078189300417, 1.6024590163934431, 1.6000000000000005, 1.59349593495935, 1.5951417004048587, 1.608870967741936, 1.6024096385542173, 1.6040000000000003, 1.6095617529880482, 1.6190476190476193, 1.6205533596837947, 1.6220472440944884, 1.623529411764706, 1.6250000000000002, 1.6225680933852142, 1.6201550387596901, 1.617760617760618, 1.6115384615384618, 1.6206896551724141, 1.622137404580153, 1.6235741444866925, 1.6212121212121215, 1.626415094339623, 1.6315789473684215, 1.625468164794008, 1.6231343283582094, 1.6282527881040896, 1.6259259259259262, 1.627306273062731, 1.632352941176471, 1.6373626373626378, 1.6313868613138691, 1.6290909090909096, 1.6557971014492758, 1.6606498194945853, 1.6618705035971229, 1.6630824372759863, 1.6571428571428577, 1.658362989323844, 1.6702127659574475, 1.664310954063605, 1.6654929577464797, 1.6736842105263166, 1.685314685314686, 1.6829268292682935, 1.6840277777777786, 1.6920415224913503, 1.689655172413794, 1.6872852233676985, 1.6883561643835625, 1.6860068259385674, 1.7006802721088443, 1.694915254237289, 1.6959459459459467, 1.6969696969696977, 1.6979865771812088, 1.709030100334449, 1.7066666666666674, 1.7076411960132898, 1.705298013245034, 1.7029702970297038, 1.700657894736843, 1.6983606557377058, 1.699346405228759, 1.6970684039087955, 1.6948051948051956, 1.6957928802589006, 1.7000000000000008, 1.7009646302250812, 1.7147435897435905, 1.7156549520766782, 1.716560509554141, 1.7174603174603182, 1.7215189873417729, 1.725552050473187, 1.723270440251573, 1.7178683385579945, 1.7187500000000007, 1.7133956386292841, 1.7080745341614914, 1.7089783281733752, 1.7037037037037044, 1.7046153846153853, 1.7055214723926386, 1.7033639143730892, 1.7042682926829273, 1.6990881458966571, 1.6969696969696975, 1.694864048338369, 1.704819277108434, 1.6996996996997, 1.6946107784431141, 1.695522388059702, 1.6964285714285718, 1.6973293768545998, 1.6952662721893494, 1.6902654867256641, 1.6911764705882357, 1.6920821114369506, 1.687134502923977, 1.6822157434402336, 1.6831395348837213, 1.6898550724637684, 1.6849710982658963, 1.6801152737752165, 1.681034482758621, 1.6819484240687683, 1.6828571428571433, 1.6837606837606842, 1.6846590909090913, 1.68271954674221, 1.68361581920904, 1.6845070422535215, 1.6882022471910116, 1.6890756302521013, 1.6927374301675981, 1.7019498607242343, 1.7027777777777782, 1.7146814404432136, 1.7099447513812158, 1.7107438016528929, 1.7060439560439564, 1.7041095890410962, 1.6994535519125686, 1.697547683923706, 1.6956521739130437, 1.6964769647696478, 1.7000000000000002, 1.7008086253369274, 1.7043010752688175, 1.702412868632708, 1.7032085561497328, 1.7013333333333336, 1.7021276595744683, 1.7029177718832893, 1.708994708994709, 1.7071240105540897, 1.713157894736842, 1.7139107611548556, 1.712041884816754, 1.7075718015665797, 1.7083333333333335, 1.703896103896104, 1.7020725388601037, 1.7002583979328165, 1.7010309278350515, 1.7017994858611825, 1.705128205128205, 1.7007672634271098, 1.6964285714285712, 1.7022900763358777, 1.7005076142131978, 1.70126582278481, 1.6994949494949494, 1.7002518891687657, 1.7035175879396984, 1.7092731829573935, 1.705, 1.7157107231920201, 1.711442786069652, 1.707196029776675, 1.7054455445544556, 1.706172839506173, 1.7068965517241381, 1.707616707616708, 1.7107843137254906, 1.7114914425427876, 1.709756097560976, 1.7080291970802923, 1.7087378640776703, 1.7070217917675548, 1.705314009661836, 1.7012048192771088, 1.699519230769231, 1.7002398081534775, 1.6985645933014357, 1.696897374701671, 1.692857142857143, 1.6959619952494063, 1.6919431279620853, 1.6973995271867612, 1.7004716981132075, 1.6988235294117646, 1.6971830985915493, 1.695550351288056, 1.6939252336448598, 1.696969696969697, 1.6953488372093024, 1.6937354988399074, 1.6944444444444446, 1.6905311778290995, 1.6889400921658988, 1.685057471264368, 1.6811926605504588, 1.6864988558352403, 1.6849315068493151, 1.683371298405467, 1.6818181818181819, 1.6802721088435375, 1.6787330316742082, 1.674943566591422, 1.6756756756756757, 1.6719101123595506, 1.6704035874439462, 1.6689038031319912, 1.6696428571428572, 1.670378619153675, 1.6711111111111112, 1.6674057649667406, 1.670353982300885, 1.6666666666666667, 1.6629955947136565, 1.665934065934066, 1.6688596491228072, 1.6673960612691467, 1.6681222707423582, 1.675381263616558, 1.673913043478261, 1.6746203904555315, 1.673160173160173, 1.673866090712743, 1.6745689655172413, 1.6731182795698925, 1.6759656652360515, 1.6745182012847966, 1.6730769230769231, 1.6695095948827292, 1.674468085106383, 1.6751592356687897, 1.6716101694915253, 1.6680761099365748, 1.6645569620253162, 1.663157894736842, 1.6617647058823528, 1.662473794549266, 1.6631799163179914, 1.659707724425887, 1.6562499999999998, 1.6569646569646568, 1.6597510373443982, 1.660455486542443, 1.6570247933884297, 1.6536082474226803, 1.6522633744855966, 1.6488706365503079, 1.6475409836065573, 1.6523517382413087, 1.6489795918367345, 1.6496945010183297, 1.6463414634146338, 1.6531440162271802, 1.6538461538461535, 1.6585858585858582, 1.6592741935483866, 1.6599597585513073, 1.6606425702811238, 1.6613226452905805, 1.6639999999999993]

"""

